environment:
    LINUX_CONFIG: "vexpress_defconfig"

depends:
    # tools
    -
        name: utils::cpio
        use: [tools]
        forward: True

    # target toolchain
    -
        name: devel::cross-toolchain-arm-linux-gnueabihf
        use: [environment, tools]
        forward: True

    - demo::initramfs
    - kernel::linux-image
    - kernel::linux-dtbs

buildScript: |
    cp -au "${BOB_DEP_PATHS[demo::initramfs]}"/* .
    cp -au "${BOB_DEP_PATHS[kernel::linux-image]}"/zImage boot/
    cp -au "${BOB_DEP_PATHS[kernel::linux-dtbs]}"/vexpress-v2p-ca9.dtb boot/

    cat >run.sh <<EOF
    #!/bin/sh
    D=\${0%/*}
    qemu-system-arm -M vexpress-a9 \\
        -kernel \$D/boot/zImage \\
        -initrd \$D/boot/initramfs.cpio.gz \\
        -append "console=tty1" \\
        -dtb \$D/boot/vexpress-v2p-ca9.dtb
    EOF

    cat >run-console.sh <<EOF
    #!/bin/sh
    D=\${0%/*}
    qemu-system-arm -M vexpress-a9 \\
        -kernel \$D/boot/zImage \\
        -initrd \$D/boot/initramfs.cpio.gz \\
        -append "console=tty1" \\
        -dtb \$D/boot/vexpress-v2p-ca9.dtb \\
        -append "console=ttyAMA0" \\
        -nographic
    EOF

    chmod +x run.sh run-console.sh

packageScript: |
    cp -au $1/* .
